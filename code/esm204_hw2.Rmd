---
title: "ESM 204 HW2"
author: "Patrick Pelegri-O'Day"
date: "4/14/2022"
output: html_document
---

```{r setup, include=FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(here)
library(tidyverse)
library(janitor)
library(broom)
```

```{r}
# Read in data
water_raw <- read_csv(here('data', 'Water_Districts.csv'))

water <- water_raw %>% clean_names()
```

```{r}
# Define linear regression models
kern_lm <- lm(mc_kern ~ reduction, data = water)
mojave_lm <- lm(mc_mojave ~ reduction, data = water)
antelope_lm <- lm(mc_antelope ~ reduction, data = water)
ventura_lm <- lm(mc_ventura ~ reduction, data = water)
```

```{r}
# TO DO
# - Pivot water data longer so that district is a variable, then plot regressions using color = district

# Plot linear regression models
ggplot(data = water) +
  geom_line(aes(x = reduction, y = mc_kern), color = "azure3") +
  geom_smooth(aes(x = reduction, y = mc_kern), method = "lm", se = FALSE, color = "firebrick4") +
  
  geom_line(aes(x = reduction, y = mc_mojave), color = "azure3") +
  geom_smooth(aes(x = reduction, y = mc_mojave), method = "lm", se = FALSE, color = "darkolivegreen4") +
 
   geom_line(aes(x = reduction, y = mc_antelope), color = "azure3") +
  geom_smooth(aes(x = reduction, y = mc_antelope), method = "lm", se = FALSE, color = "darkslategray4") +
 
   geom_line(aes(x = reduction, y = mc_ventura), color = "azure3") +
  geom_smooth(aes(x = reduction, y = mc_ventura), method = "lm", se = FALSE, color = "goldenrod4") +
  
  theme_minimal() +
  labs(x = "\nAbatement quantity (AF)",
       y = "Marginal abatement cost (USD) \n")
```

Kern's equation is y = 3.74 + 2.25x
Kern's predicted abatement MC is 340 USD for the 150th unit of abatement
Thus, the y-intercept for Kern's demand curve for water is 340 USD, and the slope of Kern's demand curve is -2.25x. Kern's demand curve: y = 340 - 2.25x.

Using the same method, we find the following demand curves for the remaining water districts

Ventura: y = 436.67 - 1.79x (total use = 245 AF)
Mojave: y = 532.71 - 3.83x (total use = 140 AF)
Antelope: y = 629.14 - 2.86x (total use = 220 AF)
```{r}
# Extrapolate MC abatement curves to abating last AF of initial water use
kern_tidy <- tidy(kern_lm)
kern_tidy

antelope_tidy <- tidy(antelope_lm)
antelope_tidy

mojave_tidy <- tidy(mojave_lm)
mojave_tidy

ventura_tidy <- tidy(ventura_lm)
ventura_tidy
```

