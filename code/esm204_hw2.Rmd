---
title: "ESM 204 HW2"
author: "Patrick Pelegri-O'Day"
date: "4/14/2022"
output: html_document
---

```{r setup, include=FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(here)
library(tidyverse)
library(janitor)
library(broom)
```

```{r}
# Read in data
water_raw <- read_csv(here('data', 'Water_Districts.csv'))

water <- water_raw %>% clean_names()
```

```{r}
# Define linear regression models
kern_lm <- lm(mc_kern ~ 0 + reduction, data = water)
mojave_lm <- lm(mc_mojave ~ 0 + reduction, data = water)
antelope_lm <- lm(mc_antelope ~ 0 + reduction, data = water)
ventura_lm <- lm(mc_ventura ~ 0 + reduction, data = water)
```

```{r}
# TO DO
# - Pivot water data longer so that district is a variable, then plot regressions using color = district

# Plot linear regression models
ggplot(data = water) +
  geom_line(aes(x = reduction, y = mc_kern), color = "azure3") +
  geom_smooth(aes(x = reduction, y = mc_kern), method = "lm", se = FALSE, color = "firebrick4") +
  
  geom_line(aes(x = reduction, y = mc_mojave), color = "azure3") +
  geom_smooth(aes(x = reduction, y = mc_mojave), method = "lm", se = FALSE, color = "darkolivegreen4") +
 
   geom_line(aes(x = reduction, y = mc_antelope), color = "azure3") +
  geom_smooth(aes(x = reduction, y = mc_antelope), method = "lm", se = FALSE, color = "darkslategray4") +
 
   geom_line(aes(x = reduction, y = mc_ventura), color = "azure3") +
  geom_smooth(aes(x = reduction, y = mc_ventura), method = "lm", se = FALSE, color = "goldenrod4") +
  
  theme_minimal() +
  labs(x = "\nAbatement quantity (AF)",
       y = "Marginal abatement cost (USD) \n")
```

Kern's equation is y = 3.74 + 2.29x
Kern's predicted abatement MC is 340 USD for the 150th unit of abatement
Thus, the y-intercept for Kern's demand curve for water is 340 USD, and the slope of Kern's demand curve is -2.25x. Kern's demand curve: y = 340 - 2.25x.

Using the same method, we find the following demand curves for the remaining water districts

Ventura: y = 436.67 - 1.79x (total use = 245 AF)
Mojave: y = 532.71 - 3.8x (total use = 140 AF)
Antelope: y = 629.14 - 1.78x (total use = 220 AF)

```{r}
# Find intecepts of MC abatement curves to calculate demand curves
kern_tidy <- tidy(kern_lm)
kern_tidy

antelope_tidy <- tidy(antelope_lm)
antelope_tidy

mojave_tidy <- tidy(mojave_lm)
mojave_tidy

ventura_tidy <- tidy(ventura_lm)
ventura_tidy
```

### Question 2: Demand curves

```{r}
# Define demand curves
kern_demand <- function(AF_used){
  AF_price <- AF_used*-2.25 + 340
}

ggplot(kern_demand, from = 0, to = 150)
```

Antelope's demand curve for water use has the highest y-intercept. In other words, Antelope water district is willing to pay the most out of any water district for the first AF of water use.

### Question 3: Policy interventions
a) Cap without trade
  1. x(220 + 140 + 150 + 245) = 500 --> x = 0.662
  3. find the magnitude of reduction for each county. take the integral from 0 to that reduction for each integral using that district's marginal cost abatement curve
  2. Add all these together
  4. No tax revenue generated
  
b) Tax on water use
  1. Stack the demand curves vertically. Find out what y is when x = 500. Set tax = to that y.
  2. 
